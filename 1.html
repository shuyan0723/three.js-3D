<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js 宇宙星空</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: #000; }
        canvas { display: block; }
        /* 提示文本 */
        .hint {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 14px;
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="hint">鼠标拖拽旋转视角 | 滚轮缩放 | 右键平移</div>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // ===================== 1. 初始化核心对象 =====================
        // 场景：所有物体的容器
        const scene = new THREE.Scene();
        // 相机：透视相机（模拟人眼视角）
        const camera = new THREE.PerspectiveCamera(
            75, // 视角（FOV）
            window.innerWidth / window.innerHeight, // 宽高比
            0.1, // 近裁剪面
            1000 // 远裁剪面
        );
        // 渲染器：负责绘制场景
        const renderer = new THREE.WebGLRenderer({
            antialias: true, // 抗锯齿
            alpha: true // 透明背景（配合星空）
        });
        renderer.setSize(window.innerWidth, window.innerHeight); // 设置画布尺寸
        renderer.setPixelRatio(window.devicePixelRatio); // 适配高清屏
        document.body.appendChild(renderer.domElement); // 挂载到页面

        // ===================== 2. 添加交互控制器 =====================
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // 阻尼效果（更顺滑）
        controls.dampingFactor = 0.05;
        controls.minDistance = 5; // 最小缩放距离
        controls.maxDistance = 50; // 最大缩放距离

        // ===================== 3. 创建星空背景 =====================
        function createStarField() {
            // 星星几何体（点模型，性能最优）
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 20000; // 星星数量
            const positions = new Float32Array(starCount * 3); // 每个星星3个坐标（x,y,z）
            const colors = new Float32Array(starCount * 3); // 每个星星3个颜色值（r,g,b）
            const sizes = new Float32Array(starCount); // 每个星星的大小

            // 随机生成星星数据
            for (let i = 0; i < starCount * 3; i += 3) {
                // 位置：随机分布在球体范围内
                positions[i] = (Math.random() - 0.5) * 2000;
                positions[i + 1] = (Math.random() - 0.5) * 2000;
                positions[i + 2] = (Math.random() - 0.5) * 2000;

                // 颜色：偏白/蓝的星空色
                colors[i] = Math.random() * 0.8 + 0.2; // r
                colors[i + 1] = Math.random() * 0.8 + 0.2; // g
                colors[i + 2] = Math.random() + 0.5; // b（偏蓝）

                // 大小：随机大小
                sizes[i / 3] = Math.random() * 2;
            }

            // 将数据绑定到几何体
            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            starGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            starGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

            // 星星材质（点材质）
            const starMaterial = new THREE.PointsMaterial({
                size: 0.5,
                vertexColors: true, // 使用顶点颜色
                transparent: true,
                opacity: 0.8,
                sizeAttenuation: true, // 距离越远越小（真实感）
                blending: THREE.AdditiveBlending // 颜色叠加（更亮）
            });

            // 创建星星点模型并添加到场景
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        // ===================== 4. 创建行星（地球+月球） =====================
        function createPlanets() {
            // ------------- 地球 -------------
            // 地球几何体（球体，分段数越高越圆）
            const earthGeometry = new THREE.SphereGeometry(5, 64, 64);
            // 地球材质（带纹理，使用免费在线纹理）
            const earthMaterial = new THREE.MeshPhongMaterial({
                map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg'), // 地表纹理
                specularMap: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_specular_2048.jpg'), // 高光纹理
                normalMap: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_normal_2048.jpg'), // 法线纹理（凹凸）
                shininess: 10 // 高光强度
            });
            const earth = new THREE.Mesh(earthGeometry, earthMaterial);
            scene.add(earth);

            // ------------- 月球（绕地球公转） -------------
            const moonGeometry = new THREE.SphereGeometry(1, 32, 32);
            const moonMaterial = new THREE.MeshPhongMaterial({
                map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/moon_1024.jpg')
            });
            const moon = new THREE.Mesh(moonGeometry, moonMaterial);
            // 创建月球轨道组（用于公转）
            const moonOrbit = new THREE.Group();
            moonOrbit.add(moon);
            moon.position.x = 15; // 月球到地球的距离
            scene.add(moonOrbit);

            // ------------- 光源（模拟太阳光） -------------
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.2); // 环境光
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1); // 平行光
            directionalLight.position.set(30, 30, 30); // 光源位置
            scene.add(directionalLight);

            // ------------- 动画：自转+公转 -------------
            function animatePlanets() {
                earth.rotation.y += 0.001; // 地球自转
                moon.rotation.y += 0.005; // 月球自转
                moonOrbit.rotation.y += 0.002; // 月球公转
                requestAnimationFrame(animatePlanets);
            }
            animatePlanets();

            return { earth, moonOrbit };
        }

        // ===================== 5. 初始化场景 =====================
        // 设置相机初始位置
        camera.position.z = 20;
        camera.position.y = 5;

        // 创建星空和行星
        createStarField();
        const { earth, moonOrbit } = createPlanets();

        // ===================== 6. 窗口自适应 =====================
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix(); // 更新相机投影矩阵
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ===================== 7. 核心动画循环 =====================
        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // 更新控制器（阻尼效果需要）
            renderer.render(scene, camera); // 渲染场景
        }
        animate();
    </script>
</body>
</html>